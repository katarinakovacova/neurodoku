<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sudoku Generator Visualization</title>
    <style>
        body {
          font-family: sans-serif;
          display: flex;
          flex-direction: column;
          align-items: center;
          margin-top: 30px;
        }
        table {
          border-collapse: collapse;
          margin-bottom: 20px;
        }
        td {
          width: 40px; height: 40px;
          border: 1px solid #ccc;
          text-align: center;
          font-size: 20px;
          transition: background-color 0.2s, color 0.2s;
        }
        .trying { background-color: #cce5ff; color: #007bff; }
        .confirmed { color: black; font-weight: bold; }
        .backtrack { background-color: #f8d7da; color: #dc3545; }
        #controls { margin-bottom: 10px; }
        #attempts { margin-top: 10px; font-size: 18px; }
        button {
          padding: 8px 16px;
          font-size: 16px;
          margin: 5px;
          cursor: pointer;
        }
    </style>
</head>
<body>
<div id="controls">
    <button onclick="start()">Play</button>
    <button onclick="stop()">Stop</button>
</div>

<table id="sudoku"></table>

<div id="attempts">Attempts: 0</div>

<script>
    const table = document.getElementById("sudoku");
    const attemptsDisplay = document.getElementById("attempts");
    let grid = [];
    let shouldStop = false;
    let attempts = 0;

    function initGrid() {
      grid = Array(9).fill(0).map(() => Array(9).fill(0));
      table.innerHTML = "";
      for (let i = 0; i < 9; i++) {
        const row = document.createElement("tr");
        for (let j = 0; j < 9; j++) {
          const cell = document.createElement("td");
          row.appendChild(cell);
        }
        table.appendChild(row);
      }
      attempts = 0;
      updateAttempts();
    }

    function updateAttempts() {
      attemptsDisplay.textContent = `Attempts: ${attempts}`;
    }

    function stop() {
      shouldStop = true;
    }

    function start() {
      shouldStop = false;
      initGrid();
      fillGrid();
    }

    const delay = ms => new Promise(res => setTimeout(res, ms));

    function isValid(grid, row, col, number) {
      for (let i = 0; i < 9; i++) {
        if (grid[row][i] === number || grid[i][col] === number) return false;
      }
      const startRow = row - row % 3, startCol = col - col % 3;
      for (let i = 0; i < 3; i++)
        for (let j = 0; j < 3; j++)
          if (grid[startRow + i][startCol + j] === number) return false;
      return true;
    }

    async function fillGrid() {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          if (grid[row][col] === 0) {
            const numbers = shuffle([1,2,3,4,5,6,7,8,9]);
            for (let num of numbers) {
              if (shouldStop) return false;

              attempts++;
              updateAttempts();

              if (isValid(grid, row, col, num)) {
                grid[row][col] = num;
                updateCell(row, col, num, "trying");
                await delay(500);

                if (await fillGrid()) {
                  updateCell(row, col, num, "confirmed");
                  return true;
                }

                grid[row][col] = 0;
                updateCell(row, col, "", "backtrack");
                await delay(500);
              }
            }
            return false;
          }
        }
      }
      return true;
    }

    function updateCell(row, col, value, className) {
      const cell = table.rows[row].cells[col];
      cell.textContent = value;
      cell.className = className;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    initGrid();
</script>
</body>
</html>
